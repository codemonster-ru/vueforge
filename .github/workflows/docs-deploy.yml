name: docs deploy

on:
    release:
        types:
            - published
    workflow_dispatch:
        inputs:
            ref:
                description: 'Git ref to deploy manually. Leave empty to deploy the current default branch state.'
                required: false
                default: ''

concurrency:
    group: docs-deploy
    cancel-in-progress: false

jobs:
    deploy-docs:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
              with:
                  ref: ${{ github.event_name == 'release' && github.event.release.tag_name || github.event.inputs.ref || github.ref }}

            - uses: actions/setup-node@v4
              with:
                  node-version: 20
                  cache: npm

            - run: npm ci

            - run: npm run build:docs

            - name: Deploy docs over FTP/FTPS
              uses: SamKirkland/FTP-Deploy-Action@v4.3.5
              with:
                  server: ${{ secrets.DOCS_FTP_HOST }}
                  username: ${{ secrets.DOCS_FTP_USERNAME }}
                  password: ${{ secrets.DOCS_FTP_PASSWORD }}
                  port: ${{ secrets.DOCS_FTP_PORT || 21 }}
                  protocol: ${{ secrets.DOCS_FTP_PROTOCOL || 'ftps' }}
                  local-dir: dist/docs/
                  server-dir: ${{ secrets.DOCS_FTP_SERVER_DIR }}/
